# ü§ñ 02-ansible

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –¥–µ–ø–ª–æ—è –Ω–∞—à–µ–≥–æ Echo App –Ω–∞ VM —Å Ubuntu 22.04.

### üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
- üéØ –¶–µ–ª—å
- üñ• Inventory
- üìú Playbook –∏ —Ä–æ–ª–∏
- üìä –ê–ª–≥–æ—Ä–∏—Ç–º –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏
- üöÄ –ó–∞–ø—É—Å–∫

---

### üéØ –¶–µ–ª—å
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Docker CE –Ω–∞ VM.  
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å 3 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å –Ω–∞—à–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º.  
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Nginx‚Äë–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫.

---

### üñ• Inventory

–§–∞–π–ª `inventory.ini` —Å–æ–¥–µ—Ä–∂–∏—Ç IP –∏ SSH‚Äë–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∞—à–µ–π VM:
[web]
```
localhost:2222 ansible_user=tropt1
```
---

### üìú Playbook –∏ —Ä–æ–ª–∏

- `playbook.yml` ‚Äî –≥–ª–∞–≤–Ω—ã–π –ø–ª–µ–π–±—É–∫, –ø–æ–¥–∫–ª—é—á–∞–µ—Ç —Ç—Ä–∏ —Ä–æ–ª–∏:
  1. `docker` ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker CE  
  2. `echo_app` ‚Äî –¥–µ–ø–ª–æ–π 3 —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ echo-app  
  3. `nginx_lb` ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∫–æ–Ω—Ñ–∏–≥ Nginx  

–†–æ–ª–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `roles/`.

---

### üìä –ê–ª–≥–æ—Ä–∏—Ç–º –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏

–í `roles/nginx_lb/templates/nginx.conf.j2` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
‚öñÔ∏è `least_conn` (–Ω–∞–∏–º–µ–Ω—å—à–µ–µ —á–∏—Å–ª–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π).

> –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ: –Ω–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å –Ω–∞–∏–º–µ–Ω—å—à–µ–π —Ç–µ–∫—É—â–µ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π, —á—Ç–æ –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç –∑–∞–¥–µ—Ä–∂–∫–∏ –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫—É –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤.

---

### üöÄ –ó–∞–ø—É—Å–∫
```bash
cd 02-ansible
ansible-playbook -i inventory.ini playbook.yml --ask-pass --ask-become-pass
```
–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
- Docker CE —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω  
- –ó–∞–ø—É—â–µ–Ω—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã echo-app –Ω–∞ –ø–æ—Ä—Ç–∞—Ö 8001, 8002, 8003  
- Nginx —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç 80 –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç—Ä–∞—Ñ–∏–∫
